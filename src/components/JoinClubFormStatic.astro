---
// Static form component compatible with GitHub Pages
// Uses Formspree for form handling
---

<div
    class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 max-w-md mx-auto"
>
    <p class="text-sm font-bold text-gray-900 dark:text-white mb-4 text-center">
        Оставьте свой email, чтобы мы могли с вами связаться, когда будем
        запускать клуб.
    </p>

    <form
        action="https://formspree.io/f/xandkapp"
        method="POST"
        id="join-club-form"
        class="space-y-4"
    >
        <div>
            <label
                for="name"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
                Имя
            </label>
            <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                placeholder="Введите имя"
            />
        </div>

        <div>
            <label
                for="email"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
                Email
            </label>
            <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                placeholder="Введите email"
            />
        </div>

        <!-- Hidden field for form identification -->
        <input
            type="hidden"
            name="_subject"
            value="New Wine Club Registration"
        />
        <input
            type="hidden"
            name="_next"
            value="https://club.bourgondier.wine/?success=true"
        />
        <input type="hidden" name="_captcha" value="false" />

        <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
            id="submit-button"
        >
            Join the Club
        </button>
    </form>

    <!-- Success/Error Messages -->
    <div id="form-message" class="mt-4 hidden">
        <div
            id="success-message"
            class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded"
        >
            <strong>Спасибо!</strong> Мы записали ваш email и свяжемся с вами в ближайшее
            время!
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById(
            "join-club-form",
        ) as HTMLFormElement;
        const submitButton = document.getElementById(
            "submit-button",
        ) as HTMLButtonElement;
        const formMessage = document.getElementById(
            "form-message",
        ) as HTMLDivElement;
        const successMessage = document.getElementById(
            "success-message",
        ) as HTMLDivElement;

        // Check URL parameters for success message
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get("success") === "true") {
            showSuccessMessage();
            // Clean up URL
            window.history.replaceState(
                {},
                document.title,
                window.location.pathname,
            );
        }

        function showSuccessMessage() {
            formMessage.classList.remove("hidden");
            successMessage.classList.remove("hidden");
            form.reset();
        }

        // Handle form submission
        form.addEventListener("submit", function (e) {
            // Show loading state
            submitButton.disabled = true;
            submitButton.textContent = "Submitting...";

            // Let the form submit naturally to Formspree
            // The hidden _next field will redirect back to our site with success parameter
        });

        // Handle form validation
        form.addEventListener("input", function () {
            const nameInput = document.getElementById(
                "name",
            ) as HTMLInputElement;
            const emailInput = document.getElementById(
                "email",
            ) as HTMLInputElement;

            // Reset button if form is being edited
            if (submitButton.disabled) {
                submitButton.disabled = false;
                submitButton.textContent = "Join the Club";
            }
        });
    });
</script>
