---
// No server-side props needed for this component
---

<div
    class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 max-w-md mx-auto"
>
    <p class="text-sm text-gray-900 dark:text-white mb-4 text-center">
        Оставьте свое имя и адрес электронной почты, чтобы мы могли связаться с
        вами, когда мы будем запускать клуб.
    </p>

    <form id="join-club-form" class="space-y-4">
        <div>
            <label
                for="name"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
                Имя
            </label>
            <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                placeholder="Введите ваше имя"
            />
        </div>

        <div>
            <label
                for="email"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
                Email
            </label>
            <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                placeholder="Введите ваш email"
            />
        </div>

        <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
        >
            Зарегистрировать интерес
        </button>
    </form>

    <!-- Success/Error Messages -->
    <div id="form-message" class="mt-4 hidden">
        <div
            id="success-message"
            class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded hidden"
        >
            <span id="success-text"></span>
        </div>
        <div
            id="error-message"
            class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded hidden"
        >
            <span id="error-text"></span>
        </div>
    </div>
</div>

<script>
    const form = document.getElementById("join-club-form") as HTMLFormElement;
    const formMessage = document.getElementById(
        "form-message",
    ) as HTMLDivElement;
    const successMessage = document.getElementById(
        "success-message",
    ) as HTMLDivElement;
    const errorMessage = document.getElementById(
        "error-message",
    ) as HTMLDivElement;
    const successText = document.getElementById(
        "success-text",
    ) as HTMLSpanElement;
    const errorText = document.getElementById("error-text") as HTMLSpanElement;

    function showMessage(type: "success" | "error", message: string) {
        // Hide both messages first
        successMessage.classList.add("hidden");
        errorMessage.classList.add("hidden");

        // Show the form message container
        formMessage.classList.remove("hidden");

        if (type === "success") {
            successText.textContent = message;
            successMessage.classList.remove("hidden");
        } else {
            errorText.textContent = message;
            errorMessage.classList.remove("hidden");
        }
    }

    function hideMessages() {
        formMessage.classList.add("hidden");
        successMessage.classList.add("hidden");
        errorMessage.classList.add("hidden");
    }

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Hide any existing messages
        hideMessages();

        // Get form data
        const formData = new FormData(form);
        const submitButton = form.querySelector(
            'button[type="submit"]',
        ) as HTMLButtonElement;

        // Disable submit button and show loading state
        submitButton.disabled = true;
        submitButton.textContent = "Сохраняем...";

        try {
            const response = await fetch("/api/join-club", {
                method: "POST",
                body: formData,
            });

            const result = await response.json();

            if (result.success) {
                showMessage("success", result.message);
                form.reset(); // Clear the form
            } else {
                showMessage("error", result.message);
            }
        } catch (error) {
            console.error("Error submitting form:", error);
            showMessage("error", "An error occurred. Please try again.");
        } finally {
            // Re-enable submit button
            submitButton.disabled = false;
            submitButton.textContent = "Join the Club";
        }
    });
</script>
