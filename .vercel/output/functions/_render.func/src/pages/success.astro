---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Бронирование подтверждено">
    <main
        class="min-h-screen bg-gradient-to-br from-white to-pink-50 dark:from-black to-gray-900 flex items-center justify-center px-4"
    >
        <div
            class="max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 text-center"
        >
            <div class="mb-6">
                <div
                    class="w-20 h-20 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center mx-auto mb-4"
                >
                    <svg
                        class="w-10 h-10 text-green-600 dark:text-green-400"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h1
                    class="text-2xl font-bold text-gray-900 dark:text-white mb-2"
                >
                    Бронирование подтверждено!
                </h1>
                <p class="text-gray-600 dark:text-gray-300">
                    Спасибо за оплату встречи.
                </p>
            </div>

            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                <h2 class="font-semibold text-gray-900 dark:text-white mb-2">
                    Детали
                </h2>
                <div
                    id="booking-details"
                    class="text-sm text-gray-600 dark:text-gray-300 space-y-1 text-left"
                >
                    <div>• Загружаем детали...</div>
                </div>
            </div>

            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                <h2 class="font-semibold text-gray-900 dark:text-white mb-2">
                    Что дальше?
                </h2>
                <ul
                    class="text-sm text-gray-600 dark:text-gray-300 space-y-1 text-left"
                >
                    <li>• Чек отправлен на указанную почту</li>
                    <li>• Мы свяжемся с вами на неделе встречи по почте</li>
                    <li>• Адрес и время будут в письме-подтверждении</li>
                </ul>
            </div>

            <div class="space-y-3">
                <a
                    href="/"
                    class="block w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-red-700 dark:bg-dark-primary dark:hover:bg-red-500 transition-colors"
                >
                    Вернуться на главную
                </a>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                    Остались вопросы? Напишите <a
                        href="https://t.me/leshakostin"
                    >
                        нам в телеграм</a
                    >.
                </p>
            </div>
        </div>
    </main>

    <script>
        // Get session ID from URL and display booking details if available
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get("session_id");

        if (sessionId) {
            // Store session ID for potential webhook verification
            localStorage.setItem("last_checkout_session", sessionId);

            // Fetch session details
            fetch(`/api/session?session_id=${sessionId}`)
                .then((response) => response.json())
                .then((data) => {
                    const detailsContainer =
                        document.getElementById("booking-details");
                    if (data.selected_date) {
                        // Format date for display
                        const dateObj = new Date(data.selected_date);
                        const months = [
                            "января",
                            "февраля",
                            "марта",
                            "апреля",
                            "мая",
                            "июня",
                            "июля",
                            "августа",
                            "сентября",
                            "октября",
                            "ноября",
                            "декабря",
                        ];
                        const weekdays = [
                            "воскресенье",
                            "понедельник",
                            "вторник",
                            "среда",
                            "четверг",
                            "пятница",
                            "суббота",
                        ];

                        const weekday = weekdays[dateObj.getDay()];
                        const day = dateObj.getDate();
                        const month = months[dateObj.getMonth()];
                        const year = dateObj.getFullYear();

                        detailsContainer.innerHTML = `
                            <div>• Дата дегустации: ${weekday}, ${day} ${month} ${year}</div>
                            <div>• Время: 18:30 - 20:00</div>
                            <div>• Стоимость: €25</div>
                            <div>• Email: ${data.customer_email || "не указан"}</div>
                        `;
                    } else {
                        detailsContainer.innerHTML =
                            "<div>• Не удалось загрузить детали бронирования</div>";
                    }
                })
                .catch((error) => {
                    console.error("Error fetching session details:", error);
                    document.getElementById("booking-details").innerHTML =
                        "<div>• Ошибка загрузки деталей</div>";
                });
        }
    </script>
</Layout>
